### 4.2 Response Payload

**Purpose:** Defines the standardized structure for responses returned by the `Sandbox API` and the `RequestRouter`. This structure ensures that the results of executing a workflow or functionality within a Sandbox are consistently communicated back to the `RequestRouter` and ultimately to the originating client.

**Structure (Conceptual):**

```json
{
  "requestId": "string", // Unique ID of the request this is a response to
  "traceId": "string", // Trace ID for the overall operation
  "appId": "string", // The unique identifier of the application that processed the request
  "workflowId": "string", // The specific workflow or functionality that was executed
  "status": "string", // The status of the execution ("success", "error", "pending", etc.)
  "output": { // Data representing the successful result of the execution, varies based on workflowId
    // ... output data defined by the target workflow's output schema ...
  },
  "error": { // Details about an error if status is "error"
    "code": "string", // A code representing the type of error
    "message": "string", // A human-readable message describing the error
    "details": { // Optional: additional structured error details
      // ... error-specific data ...
    }
  },
  "toolCalls": [ // A list of tool calls made during the execution of this request
    {
      "toolName": "string",
      "serverName": "string", // Empty for core tools
      "argumentsJson": "string", // Arguments passed to the tool
      "toolCallId": "string", // Unique ID for this tool call instance
      "status": "string", // Status of the tool call ("initiated", "running", "completed", "error")
      "resultJson": "string", // Result of the tool call (if completed)
      "error": { // Error details if tool call status is "error"
        "code": "string",
        "message": "string"
      }
    }
    // ... more tool call objects ...
  ],
  "events": [ // A list of events published during the execution of this request
    {
      "eventType": "string",
      "sourceAppId": "string",
      "traceId": "string",
      "payloadJson": "string",
      "context": { // Contextual information related to the event
        // ... event context ...
      },
      "timestamp": "string" // ISO 8601 timestamp of when the event occurred
    }
    // ... more event objects ...
  ]
}
```

**Key Fields:**

*   `requestId`: Matches the `requestId` from the corresponding `Request Payload`, allowing correlation.
*   `traceId`: Matches the `traceId` from the corresponding `Request Payload`, linking this response to the overall task thread.
*   `appId`: Identifies the application that processed the request.
*   `workflowId`: Identifies the specific workflow or functionality that was executed.
*   `status`: Indicates the outcome of the execution (e.g., "success", "error").
*   `output`: A flexible JSON object containing the result data if the execution was successful. Its structure is defined by the output schema of the target workflow.
*   `error`: A JSON object providing details if the execution resulted in an error. Includes a `code`, `message`, and optional `details`.
*   `toolCalls`: An array listing all tool calls initiated during the processing of this request. Each entry includes details about the tool, arguments, status, and result/error. This provides transparency into the actions taken by the application/AI.
*   `events`: An array listing all events published to the `EventBus` during the processing of this request. This provides a record of significant occurrences during execution.

**Relationship to other Components:**

*   Generated by the `Sandbox API` after executing a request.
*   Received by the `RequestRouter` and returned to the external client.
*   Processed by the external client (e.g., VSCode extension) to display results, errors, tool activity, and events to the user.
*   The `toolCalls` and `events` arrays provide data that can be used by the UI or other monitoring components.
