## 2.0 High-Level Architecture

**Purpose:** This section provides a high-level overview of the Nexus CoCreate AI system architecture, illustrating the main components and their interactions. It serves as a visual and conceptual map of the system's structure.

**Conceptual High-Level Diagram:**

```mermaid
graph TD
    UserInterface[User Interface (VSCode Extension/Web)] --> RequestRouter
    RequestRouter --> SandboxManager
    RequestRouter --> CoreFrameworkAPI
    RequestRouter --> ApplicationRegistry
    RequestRouter --> StateManagerInterface
    RequestRouter --> EventBus
    RequestRouter --> LoggingService

    SandboxManager --> Sandbox[Sandbox (Isolated Environment)]
    Sandbox --> SandboxAPI
    SandboxAPI --> CoreFrameworkAPI

    CoreFrameworkAPI --> StateManagerInterface
    CoreFrameworkAPI --> ToolManager
    CoreFrameworkAPI --> LoggingService
    CoreFrameworkAPI --> ApplicationRegistry

    ToolManager --> McpHub
    McpHub --> MCP[External MCP Servers]

    StateManagerInterface --> PersistentState[Persistent State (Git/DB)]

    EventBus --> UserInterface
    EventBus --> LoggingService
    EventBus --> OtherSubscribers[Other Subscribers]

    LoggingService --> LogStorage[Log Storage/Monitoring]

    subgraph Core System
        RequestRouter
        SandboxManager
        CoreFrameworkAPI
        ApplicationRegistry
        StateManagerInterface
        EventBus
        LoggingService
        ToolManager
        McpHub
    end

    subgraph External
        UserInterface
        MCP
        PersistentState
        LogStorage
        OtherSubscribers
    end

    classDef default fill:#f9f,stroke:#333,stroke-width:2px;
    classDef core fill:#ccf,stroke:#333,stroke-width:2px;
    classDef external fill:#cfc,stroke:#333,stroke-width:2px;

    class RequestRouter,SandboxManager,CoreFrameworkAPI,ApplicationRegistry,StateManagerInterface,EventBus,LoggingService,ToolManager,McpHub core;
    class UserInterface,MCP,PersistentState,LogStorage,OtherSubscribers external;

```

**Component Overview:**

*   **User Interface (UI):** The client-side application (e.g., VSCode extension webview) where users interact with the system.
*   **Request Router:** The entry point for incoming user requests, responsible for routing them to the appropriate component or Sandbox.
*   **Sandbox Manager:** Manages the lifecycle of isolated execution environments (Sandboxes) where application and AI logic runs.
*   **Sandbox API:** The interface exposed by a Sandbox, allowing the application/AI within to communicate with the core system.
*   **Core Framework API:** Provides a standardized interface for Sandboxes to access core system functionalities (state, tools, logging).
*   **Application Registry:** Stores and manages definitions and metadata for all registered applications.
*   **StateManagerInterface:** Manages the persistent, version-controlled project state (definitions, configurations, knowledge).
*   **Tool Manager:** Discovers, registers, and routes requests to available tools (core and MCP).
*   **McpHub:** Manages connections to external MCP servers and exposes their tools and resources.
*   **Event Bus:** A publish-subscribe system for asynchronous communication and real-time updates.
*   **Logging Service:** Collects, processes, and stores structured log messages from all components.
*   **Persistent State:** The underlying storage mechanism for the versioned project state (e.g., Git repository, database).
*   **External MCP Servers:** External services providing additional tools and resources via the Model Context Protocol.
*   **Log Storage/Monitoring:** External systems for storing, analyzing, and visualizing log data.

**Interaction Summary:**

User requests originate from the UI, are processed by the Request Router, and typically routed to a Sandbox managed by the Sandbox Manager. Application/AI logic within the Sandbox interacts with the core system via the Sandbox API and Core Framework API to access state, execute tools (potentially via MCP servers), and log events. The Event Bus facilitates real-time updates back to the UI and other subscribers. All security-relevant interactions are subject to authentication and authorization enforced by core components.
