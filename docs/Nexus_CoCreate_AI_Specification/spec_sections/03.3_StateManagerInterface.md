# 3.3 StateManagerInterface

## 3.3.1 Introduction

State management is a cornerstone of the Nexus CoCreate AI platform, providing the context, definitions, configuration, and runtime data necessary for applications to function dynamically and adaptively. This section details the conceptual content of the state, the chosen storage mechanisms for different types of state, and how state is accessed via the internal `StateManagerInterface` API (defined in Section 2.1.3).

## 3.3.2 Conceptual Content of State

The state associated with a Nexus CoCreate AI application encompasses several distinct categories of information:

*   **`ApplicationDefinition`:** The high-level blueprint of the application, including metadata, sandbox configurations, security settings, optimization rules, and state storage configuration. (See Section 4.7 for `AppDefinition` data model).
*   **`ComponentRegistry`:** Maps logical application parts or routes to their specific implementations (LLM, JIT, WORKFLOW), including handler types, target sandbox pools, task details, and routing information. This is a primary lookup for the `RequestRouter`.
*   **Workflow Definitions:** Declarative YAML files defining multi-step processes, stored within the definition state.
*   **Prompt Templates:** YAML files defining the structure and content of prompts used by `LLM` handler types, stored within the definition state.
*   **JIT Code Artifacts:** Source code files (e.g., Python, Node.js) and associated tests generated by the `OptimizationOracle`, stored within the definition state.
*   **Agent/Application Context & Memory:** As defined in Section 3.21, this includes `AgentBrief.md`, `OperationalContext.md`, `KnowledgeBase/`, and `AgentConfig.yaml`, forming part of the definition state.
*   **Runtime Data:** Ephemeral state information relevant during active request processing or short-term operation, such as session data, temporary workflow variables, short-term cache, and distributed locks.
*   **MCP Servers Configuration:** Details of available Community and Application-Specific MCP servers.
*   **Performance Logs/Metrics Context:** Aggregated summaries or historical performance trends relevant for optimization decisions.
*   **Optimization Decisions Log:** A history of optimization actions taken by the `OptimizationOracle`.
*   **Application Domain Data:** **This is NOT managed by the framework's core state management.** It resides in external databases or object storage, accessed by sandboxes via dedicated Community MCP Servers.

## 3.3.3 Storage Mechanisms

Nexus CoCreate AI employs a hybrid storage strategy:

### 3.3.3.1 Definition/Config State: Git + YAML Files

*   **Mechanism:** Core application definition, configuration, component registry, workflows, prompts, JIT code, and Agent/Application Context & Memory are stored as text files (primarily YAML) in a Git repository.
*   **Rationale:** Provides versioning, history, traceability, auditability, LLM/tool processability, atomic commits, and branching/merging capabilities.
*   **Access:** Via file-like methods on the `StateManagerInterface`.

### 3.3.3.2 Runtime Ephemeral State: Redis

*   **Mechanism:** Transient `RuntimeData` is stored in Redis.
*   **Rationale:** Offers high performance, atomic operations, and TTL support for ephemeral data.
*   **Access:** Via key-value methods on the `StateManagerInterface`. Keys are namespaced by `appId`.

### 3.3.3.3 Application Domain Data: External Databases (via MCP)

*   **Mechanism:** Application-specific business data resides in external databases or object storage.
*   **Rationale:** Separates operational state from business data, leveraging mature database technologies.
*   **Access:** Sandboxes use standardized MCP tools provided by Community MCP Servers.

## 3.3.4 Access API (`StateManagerInterface`)

All interactions with both Definition/Config State and Runtime State by framework components or sandboxes (via Core MCP wrappers) **MUST** go through the `StateManagerInterface` Internal API (specified in Section 2.1.3). This ensures abstraction, consistency, security, and maintainability.
