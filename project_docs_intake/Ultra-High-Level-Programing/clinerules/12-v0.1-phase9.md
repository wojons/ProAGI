# Suggested .clinerules Additions for Phase 9

## Authentication & Authorization
*   All Admin API endpoints MUST call `check_permission`.
*   All sensitive MCP tools MUST call `check_permission` with appropriate required permission strings.
*   API Key validation MUST use secure hashing comparison (`werkzeug.security.check_password_hash` or similar). Plaintext key comparison is forbidden.
*   User context (ID, roles) resolved from authentication tokens MUST be securely passed to `check_permission` and included in sandbox context (`context.userInfo`) where appropriate.

## Workflow Engine
*   New control flow steps (e.g., `loop`, `branch`) MUST have corresponding integration tests covering their logic and data handling.
*   Expression evaluation logic (`_evaluate_jsonpath`, condition parsing) MUST include robust type checking and error handling for invalid expressions or missing data.

## Community MCP Servers
*   Community MCP server implementations MUST follow the structure of Core MCP (`server.py`, `schemas/`, `tests/`).
*   Community MCP tools MUST validate input `params` against their JSON schema.
*   Community MCPs managing external credentials MUST isolate them per `appId` and load them securely (e.g., via environment variables, not hardcoded).
*   Community MCPs SHOULD include integration tests mocking the external service they interact with.

## Sample Applications
*   Sample applications (e.g., in `sample_apps/`) serve as integration tests for the framework and MUST define their components using workflows and prompts. Avoid hardcoding complex logic directly in JIT unless demonstrating optimization.