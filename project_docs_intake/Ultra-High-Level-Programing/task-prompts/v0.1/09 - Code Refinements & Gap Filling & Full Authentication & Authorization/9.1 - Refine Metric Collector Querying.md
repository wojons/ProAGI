# Task 9.1: Refine Metric Collector Querying

**Goal:** Refactor the `query_metric` method in `@core/metrics/metric_collector.py` and potentially the `OptimizationOracle` to support querying aggregated, time-windowed metrics necessary for optimization rules (acknowledging V1 might still mock this).

**Context:**
- Metric Collector: `@core/metrics/metric_collector.py`
- Collector Interface: `@core/interfaces/metric_collector_interface.py`
- Oracle: `@core/optimization/optimization_oracle.py`
- Metric Condition Model: `MetricCondition` in `@core/shared/data_models.py`
- Gap Analysis: Task 7.5 [55] implementation is too basic.

**Plan:**

1.  **Analyze:** Review `MetricCondition` fields (`metric_name`, `aggregation`, `window`). Review Task 7.5 [55] implementation in `@core/metrics/metric_collector.py`.
2.  **Modify Interface:** Use `write_to_file` to update the `query_metric` signature in `@core/interfaces/metric_collector_interface.py` to better reflect potential needs, e.g., `query_aggregate(self, metric_name: str, labels: Dict[str, str], aggregation: str, window: str) -> Optional[float]:`.
3.  **Modify Implementation (Placeholder/TODO):** Use `write_to_file` to update `@core/metrics/metric_collector.py`. Implement the new `query_aggregate` method.
    *   Since querying Prometheus directly from the `prometheus-client` registry is hard, **implement a placeholder**.
    *   Log a clear warning that this is mock data.
    *   Return a mock float value (e.g., based on metric name or labels) or `None`.
    *   Add a detailed `# TODO (V2): Implement actual query logic by scraping self (/metrics endpoint) or querying a Prometheus backend via HTTP API.` comment.
4.  **Update Oracle:** Use `write_to_file` to modify `@core/optimization/optimization_oracle.py` (`_should_optimize` method).
    *   Update calls to use the new `metric_collector.query_aggregate` method, passing parameters based on `OptimizationRule.conditions`.
    *   Keep the existing logic that handles the `None` return value (if metrics are unavailable).
5.  **Update Tests:** Use `write_to_file` to update tests in `tests/core/optimization/test_optimization_oracle.py` and `tests/core/metrics/test_metric_collector.py` to reflect the new interface and placeholder behavior.

**Expected Outcome:** Interfaces and placeholder implementations are updated for time-windowed metric queries, with clear TODOs for a real implementation. Oracle uses the new interface.