## Goal: Harden Security of Core MCP Command Execution

Review the implementation of the `core.linux.executeCommand` handler within the `CoreMCPServer` and apply security best practices based on `08-security.md` [11, 25].

**Context:**
*   MCP Server Code: `@mcp_servers/core/server.py` (Locate the handler for `core.linux.executeCommand`)
*   Security Design Doc: `08-security.md` [11, 25] (Low privilege user, whitelisting, no shell=True, hardened wrappers, timeouts, input validation)
*   Project Standards: `@.clinerules`

**Plan:**

1.  **Read Server Code:** Use `read_file` to get the content of `@mcp_servers/core/server.py`.
2.  **Locate Handler:** Find the `async` function responsible for handling the `core.linux.executeCommand` tool requests.
3.  **Analyze Current Implementation:** Examine how the command and arguments are processed and executed (likely using `subprocess` or `asyncio.create_subprocess_exec`).
4.  **Apply Security Measures:** Modify the handler function to incorporate the following (if missing):
    *   **Input Validation:** Rigorously validate the `command` and `args` parameters received. Check for disallowed characters or structures.
    *   **Strict Whitelisting:** Implement a strict whitelist of allowed command *names*. Reject any command not explicitly on the list. The list should be configurable and minimal.
    *   **No Shell Interpretation:** Ensure `shell=False` (or equivalent) is used in the `subprocess` / `asyncio` call to prevent shell injection vulnerabilities. Arguments should be passed as a list.
    *   **Hardened Wrappers (Conceptual):** For potentially risky allowed commands (e.g., `curl`, `git`), log a `# TODO: Implement hardened wrapper` comment. The wrapper itself would be a separate script/function that performs more granular argument validation specific to that command.
    *   **Low Privilege User:** Add a log/comment `# TODO: Ensure MCP server process (or subprocess) runs as low-privilege user`. The actual user change is often part of deployment/container setup.
    *   **Timeouts:** Ensure a reasonable timeout is applied to the subprocess execution.
    *   **Resource Limits (Conceptual):** Add a log/comment `# TODO: Apply resource limits (CPU/memory) to subprocess if possible`.
    *   **Clear Logging:** Log the exact command and arguments being executed (after validation), the outcome (exit code, stdout/stderr snippets), and any security rejections.
5.  **Save Changes:** Use `write_to_file` to save the modified content back to `@mcp_servers/core/server.py`.

**Expected Outcome:**
*   The `core.linux.executeCommand` handler in `@mcp_servers/core/server.py` is updated with enhanced security checks based on the design document, including whitelisting, avoiding `shell=True`, and adding placeholders/comments for more advanced measures.