## Goal: Finalize Core Data Structures using Pydantic

Thoroughly review the Pydantic models in `@core/shared/data_models.py` against the detailed Protobuf definitions in Design Doc Section 3.1.5 [18]. Implement all missing models and fields, ensuring nested structures match the specification precisely. Enhance validation where appropriate.

**Context:**
*   Existing Data Models: `@core/shared/data_models.py` (Partially updated in Phase 6)
*   Target Specification: Design Doc Section 3.1.5 ([18]) - Cross-reference *all* defined messages/enums.
*   Python Standards: `@.clinerules` (`01-core-framework.md` [4])

**Plan:**

1.  **Read Existing File:** Use `read_file` to load `@core/shared/data_models.py`.
2.  **Cross-Reference Spec:** Perform a detailed comparison between the current Pydantic models and ALL messages/enums defined in Section 3.1.5 [18].
3.  **Add Missing Models/Enums:** Use `write_to_file` to add any missing Pydantic `BaseModel` definitions or Python `enum.Enum` classes. Specific models likely missing or needing detail include:
    *   `InterAppPermission`
    *   `UserRoleDefinition`
    *   `MetricCondition` (needs precise fields for querying metrics)
    *   `OptimizationTrigger` (containing conditions)
    *   `OptimizationRule` (linking trigger to action)
    *   Potentially add more granular models for `taskDetails` based on `handlerType`.
4.  **Refine Nested Structures:** Pay close attention to how models are nested. Ensure lists and dictionaries contain the correct Pydantic model types. Specifically review:
    *   `OptimizationConfig`: Ensure `rules: List[OptimizationRule]` is correctly defined and `OptimizationRule` properly includes trigger/action details.
    *   `SecurityConfig`: Ensure `apiKeys: List[ApiKeyDefinition]`, `roles: List[UserRoleDefinition]`, `interAppPermissions: List[InterAppPermission]` are correctly modelled.
    *   `ComponentDefinition`: Refine `routeMatcher: RouteMatcher` if needed.
5.  **Use `pydantic.Field`:** Where appropriate, use `Field` for:
    *   Default values (e.g., `Field(default_factory=list)`).
    *   Aliases if needed (e.g., `Field(alias="...")`).
    *   Basic validation (e.g., `Field(min_length=1)` for required strings, regex for paths).
6.  **Update Imports & Docstrings:** Ensure all necessary types are imported and add/update docstrings for new/modified models.
7.  **Save Changes:** Use `write_to_file` to save the finalized `@core/shared/data_models.py`.
8.  **Review Dependent Code (Conceptual):** Note that changes here may require updates in components that use these models (e.g., `ApplicationRegistry`, `OptimizationOracle`, API handlers). Subsequent prompts should address this.

**Expected Outcome:**
*   `@core/shared/data_models.py` now contains Pydantic models that fully and accurately reflect the data structures defined in Design Doc Section 3.1.5 [18].