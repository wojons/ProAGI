# Task 8.5: Add Basic Monitoring View to Admin Panel

**Goal:** Enhance the Admin Panel (`@admin_panel/app.py`) to display basic operational metrics fetched from the Core Framework's `/metrics` endpoint.

**Context:**
- Admin Panel Code: `@admin_panel/app.py`, `@admin_panel/templates/`
- Metrics Endpoint: Exposed by `RequestRouter` at `/metrics` (Prometheus format). Task 5.1 [45] implemented the collector, Task 6.3 [53] integrated pushing.
- Libraries: `Flask`, `Jinja2`, `httpx`, `prometheus-client` (for parsing).

**Plan:**

1.  **Add Dependency:** Use `write_to_file` to add `prometheus-client` to `@admin_panel/requirements.txt`. Use `execute_command` to install.
2.  **Analyze Prometheus Format:** Briefly inspect the expected Prometheus text format exposed by `/metrics`. Identify key UHLP metrics (e.g., `uhlp_framework_request_total`, `uhlp_framework_request_duration_ms_bucket`, `uhlp_sandbox_instances`).
3.  **Create New Route/Template:**
    *   Use `write_to_file` to add a new route `/monitoring` in `@admin_panel/app.py`.
    *   Use `write_to_file` to create a new template `@admin_panel/templates/monitoring.html`.
4.  **Implement Route Logic (`/monitoring` in `app.py`):**
    *   The Flask route handler should:
        *   Make a `GET` request to `CORE_API_URL/metrics` using `httpx`. Handle potential errors.
        *   Parse the Prometheus text response using `prometheus_client.parser.text_string_to_metric_families`.
        *   Iterate through the parsed metrics. Extract relevant values for key UHLP metrics (e.g., total requests per app, current running sandboxes per pool). Aggregate/summarize if needed (e.g., calculate average latency from histogram).
        *   Pass the extracted/formatted metrics data to the `monitoring.html` template.
5.  **Implement Template (`monitoring.html`):**
    *   Extend `base.html`.
    *   Display the metrics data passed from the route in a user-friendly format (e.g., tables). Show metrics like:
        *   Total Requests (by App, by Status Code).
        *   Average Latency (potentially by App or overall).
        *   Number of Running Sandbox Instances (by App/Pool).
    *   Add basic refresh mechanism (e.g., meta refresh or simple JS interval) if desired.
6.  **Update Navigation:** Add a link to `/monitoring` in `@admin_panel/templates/base.html`.

**Expected Outcome:** A new page in the Admin Panel displaying key operational metrics scraped from the framework's Prometheus endpoint.