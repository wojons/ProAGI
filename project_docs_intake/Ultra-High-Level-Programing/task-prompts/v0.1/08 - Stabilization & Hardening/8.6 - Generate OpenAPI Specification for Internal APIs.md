# Task 8.6: Generate OpenAPI Specification for Internal APIs

**Goal:** Create an OpenAPI 3.x specification (YAML) documenting the internal HTTP APIs exposed by the Core Framework (specifically the Admin API endpoints added in Task 6.2).

**Context:**
- API Endpoints: `/internal/*` implemented in `@core/routing/request_router.py`.
- Documentation Standards: `@.clinerules/10-documentation.md` [1, 13] requires OpenAPI for HTTP APIs.
- Data Models: `@core/shared/data_models.py` (used in request/response bodies).

**Plan:**

1.  **Analyze API Handlers:** Read `@core/routing/request_router.py`. Identify the exact paths, methods, request body expectations (JSON/YAML `AppDefinition`), and response structures (JSON `AppDefinition`, list of strings, error objects) for the `/internal/apps` and `/internal/apps/{app_id}` endpoints.
2.  **Create OpenAPI File:** Use `write_to_file` to create `docs/api/internal_admin_api.openapi.yaml`.
3.  **Write OpenAPI Spec:** Populate the YAML file following OpenAPI 3.x syntax:
    *   Define `openapi`, `info` (title, version, description).
    *   Define `servers` (e.g., `url: {CORE_API_URL}` - placeholder).
    *   Define `paths`:
        *   `/internal/apps`:
            *   `get`: Describe list operation, parameters (none), responses (200 with schema for `{"applications": ["id1", ...]}`).
            *   `post`: Describe register operation, `requestBody` (required, content types `application/json` and `application/yaml`, schema `$ref: '#/components/schemas/AppDefinition'`), responses (201 with `$ref: '#/components/schemas/AppDefinition'`, 400, 409, 500 with error schemas).
        *   `/internal/apps/{app_id}`:
            *   Define `parameters` for `app_id` (path parameter, required, string).
            *   `get`: Describe get details operation, responses (200 with `$ref: '#/components/schemas/AppDefinition'`, 404, 500).
            *   `put`, `delete`: Describe update/deregister stubs (potentially marking as `deprecated` or `x-not-implemented`, response 501).
    *   Define `components.schemas`:
        *   Define `AppDefinition` based on the Pydantic model in `@core/shared/data_models.py`. **Crucially, translate the Pydantic model structure into JSON Schema format.** Include nested schemas for `SandboxPoolConfig`, `ComponentDefinition`, etc.
        *   Define a generic `ErrorResponse` schema (`type: object`, properties: `code`, `message`, `details`).
4.  **Add Descriptions:** Ensure all paths, operations, parameters, request bodies, responses, and schemas have clear `description` fields.
5.  **Review & Validate:** Review the generated YAML for correctness and use an OpenAPI validator tool (online or CLI) to check syntax.

**Expected Outcome:** A valid OpenAPI 3.x specification file (`internal_admin_api.openapi.yaml`) documenting the internal administrative HTTP API.